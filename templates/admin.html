<!DOCTYPE html>
<html>
<head>
<title>{{title}}</title>
<meta charset="UTF-8">
{{ dropzone.load_css() }}
<link rel="stylesheet" href="/static/style.css">
{{ dropzone.load_js() }}
<script src="/static/helper.js"></script>
<script nonce="{{nonce}}">
  {# The confirmation JavaScript code is here to ensure, that the code is present, when browser loads the page. #}
  window.onload = function() {
      for (let f of document.getElementsByName("del-confirm")) {
	  f.onsubmit = function() { return confirm('{{_("Sind Sie sicher?")}}'); };
      }
  };  
</script>
</head>
<body>
<h1>{{organization}} – {{_("Administration")}}</h1>
<h2>{{_("Mandanten")}}</h2>
<ul>
{%- for item in users %}
  <li><form action="/admin/del-user/{{item}}" name="del-confirm" method="post">
      <input type="hidden" name="_method" value="DELETE">
      <button class="delete">{{_("Löschen")}}</button>
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/></form>
    <button class="edit" name="edit" value="{{item}}">edit</button>
    <a href="/admin/{{documentsdir}}/{{item}}">{{item}}</a> <small>{{_("Mandanten-URL")}}: {{url_root}}{{documentsdir}}/{{item}}</small>
  </li>
{%- endfor %}
<li>
  <form action="/admin/new-user" method="post">
    <input id="user" name="user" type="text" placeholder="Name" required></input>
    <input id="password" name="password" type="text" placeholder="Passwort" autocomplete="off" required></input>
    <button class="add" id="generatePassword" type="button">{{_("Generieren")}}</button>
    <button class="add" id="copyPassword" type="button">{{_("Kopieren")}}</button>
    <button class="add">{{_("Hinzufügen")}}</button>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  </form>
</li>
</ul>

{%- if support_public_docs %}

<h2>{{_("Öffentliche Dokumente")}}</h2>
<ul>
{%- for item in tree.children recursive %}
<li>
  <form action="/admin/{{ item.name }}" method="post" name="del-confirm">
    <input type="hidden" name="_method" value="DELETE">
    <button class="delete">{{_("Löschen")}}</button>
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  </form>
  <a href="{{ item.name }}" download="{{item.download}}">{{ item.download }}</a>
  {%- if item.children -%}
  <ul>{{ loop(item.children) }}</ul>
  {%- endif %}</li>
{%- endfor %}
</ul>

<h2>{{_("Öffentliches Dokument hochladen")}}</h2>
<div class="droppy">{{ dropzone.create(action='/admin') }}</div>

{{ dropzone.config(nonce=nonce) }}

{% endif -%}

</body>
</html>
